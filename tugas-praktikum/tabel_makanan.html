<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Makanan Khas Sulawesi Selatan</title>
    <link rel="stylesheet" href="/praktikum4/css/style.css" />
  </head>
  <body>
    <header>Makanan Khas</header>

    <div class="container">
      <aside class="sidebar">
        <nav>
          <ul>
            <li><a href="#">Dashboard</a></li>
            <li><a href="tabel_makanan.html">Makanan Khas</a></li>
            <li><a href="tabel_wisata.html">Objek Wisata</a></li>
            <li><a href="#">Keluar</a></li>
          </ul>
        </nav>
      </aside>

      <section class="content">
        <h1>Daftar Makanan Khas Sulawesi Selatan</h1>

        <form id="food-form">
          <h2>Tambah Makanan Khas</h2>
          <label for="food-name">Nama Makanan:</label>
          <input
            type="text"
            id="food-name"
            name="food-name"
            placeholder="Masukkan nama makanan..."
          />

          <label for="food-desc">Deskripsi Makanan:</label>
          <input
            type="text"
            id="food-desc"
            name="food-desc"
            placeholder="Masukkan deskripsi makanan..."
          />

          <label for="food-image">Gambar Makanan:</label>
          <input
            type="file"
            id="food-image"
            name="food-image"
            accept="image/*"
          />

          <div class="add-button">
            <button type="submit" id="submit-btn">Tambah</button>
          </div>
        </form>

        <table id="food-table">
          <thead>
            <tr>
              <th>No</th>
              <th>Nama Makanan</th>
              <th>Gambar</th>
              <th>Deskripsi</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>Coto Makassar</td>
              <td>
                <img
                  src="/praktikum4/assets/Coto_Makassar.png"
                  alt="Coto Makassar"
                  width="100"
                />
              </td>
              <td>
                Hidangan sup tradisional khas Makassar, terbuat dari daging sapi
                dan rempah khas.
              </td>
              <td>
                <button class="edit-btn" onclick="editRow(this)">Edit</button>
                <button class="delete-btn" onclick="deleteRow(this)">
                  Hapus
                </button>
              </td>
            </tr>
            <tr>
              <td>2</td>
              <td>Pallubasa</td>
              <td>
                <img
                  src="/praktikum4/assets/Palubasa.png"
                  alt="Pallubasa"
                  width="100"
                />
              </td>
              <td>
                Makanan khas Makassar, mirip dengan Coto Makassar namun dengan
                tambahan kelapa parut.
              </td>
              <td>
                <button class="edit-btn" onclick="editRow(this)">Edit</button>
                <button class="delete-btn" onclick="deleteRow(this)">
                  Hapus
                </button>
              </td>
            </tr>
            <tr>
              <td>3</td>
              <td>Pisang Ijo</td>
              <td>
                <img
                  src="/praktikum4/assets/Pisang_ijo.png"
                  alt="Pisang Ijo"
                  width="100"
                />
              </td>
              <td>
                Hidangan penutup berbahan dasar pisang yang dibalut dengan
                adonan tepung berwarna hijau.
              </td>
              <td>
                <button class="edit-btn" onclick="editRow(this)">Edit</button>
                <button class="delete-btn" onclick="deleteRow(this)">
                  Hapus
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>

    <script>
      let editingRow = null;

      const foodForm = document.getElementById("food-form");
      const foodTable = document
        .getElementById("food-table")
        .getElementsByTagName("tbody")[0];
      const submitBtn = document.getElementById("submit-btn");

      // Fungsi untuk menyimpan tabel ke sessionStorage
      function saveTableToSession() {
        const tableData = [];
        const rows = foodTable.rows;

        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          const rowData = {
            name: row.cells[1].textContent,
            image: row.cells[2].querySelector("img").src,
            description: row.cells[3].textContent,
          };
          tableData.push(rowData);
        }

        sessionStorage.setItem("foodTableData", JSON.stringify(tableData));
      }

      // Fungsi untuk memuat tabel dari sessionStorage
      function loadTableFromSession() {
        const savedData = sessionStorage.getItem("foodTableData");

        if (savedData) {
          const tableData = JSON.parse(savedData);
          foodTable.innerHTML = "";

          tableData.forEach((food, index) => {
            const newRow = foodTable.insertRow();

            const cellNo = newRow.insertCell(0);
            const cellName = newRow.insertCell(1);
            const cellImage = newRow.insertCell(2);
            const cellDesc = newRow.insertCell(3);
            const cellAction = newRow.insertCell(4);

            cellNo.textContent = index + 1;
            cellName.textContent = food.name;
            cellImage.innerHTML = `<img src="${food.image}" alt="${food.name}" width="100">`;
            cellDesc.textContent = food.description;
            cellAction.innerHTML = `
              <button class="edit-btn" onclick="editRow(this)">Edit</button>
              <button class="delete-btn" onclick="deleteRow(this)">Hapus</button>
            `;
          });
        }
      }

      // Muat data saat halaman dibuka
      window.addEventListener("load", loadTableFromSession);

      foodForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const foodName = document.getElementById("food-name").value;
        const foodDesc = document.getElementById("food-desc").value;
        const foodImageFile = document.getElementById("food-image").files[0];

        if (foodName && foodDesc && foodImageFile) {
          if (editingRow) {
            const cellName = editingRow.cells[1];
            const cellImage = editingRow.cells[2];
            const cellDesc = editingRow.cells[3];

            cellName.textContent = foodName;
            cellDesc.textContent = foodDesc;

            const reader = new FileReader();
            reader.onload = function (e) {
              cellImage.innerHTML = `<img src="${e.target.result}" alt="${foodName}" width="100">`;
              saveTableToSession(); // Simpan setelah edit
            };
            reader.readAsDataURL(foodImageFile);
            editingRow = null;
            submitBtn.textContent = "Tambah";
          } else {
            const newRow = foodTable.insertRow();

            const cellNo = newRow.insertCell(0);
            const cellName = newRow.insertCell(1);
            const cellImage = newRow.insertCell(2);
            const cellDesc = newRow.insertCell(3);
            const cellAction = newRow.insertCell(4);

            cellNo.textContent = foodTable.rows.length;
            cellName.textContent = foodName;

            const reader = new FileReader();
            reader.onload = function (e) {
              cellImage.innerHTML = `<img src="${e.target.result}" alt="${foodName}" width="100">`;
              saveTableToSession(); // Simpan setelah tambah
            };
            reader.readAsDataURL(foodImageFile);

            cellDesc.textContent = foodDesc;
            cellAction.innerHTML = `
                        <button class="edit-btn" onclick="editRow(this)">Edit</button>
                        <button class="delete-btn" onclick="deleteRow(this)">Hapus</button>
                    `;
          }
          foodForm.reset();
        } else {
          alert("Nama, Deskripsi, dan Gambar harus diisi.");
        }
      });

      function deleteRow(button) {
        const konfirmasi = confirm(
          "Apakah Anda yakin ingin menghapus data ini?"
        );

        if (konfirmasi) {
          const row = button.parentElement.parentElement;
          row.parentElement.removeChild(row);

          const rows = document
            .getElementById("food-table")
            .getElementsByTagName("tbody")[0].rows;
          for (let i = 0; i < rows.length; i++) {
            rows[i].cells[0].textContent = i + 1;
          }

          saveTableToSession(); // Simpan setelah hapus
        }
      }

      function editRow(button) {
        const row = button.parentElement.parentElement;
        editingRow = row;

        const foodName = row.cells[1].textContent;
        const foodDesc = row.cells[3].textContent;
        document.getElementById("food-name").value = foodName;
        document.getElementById("food-desc").value = foodDesc;
        submitBtn.textContent = "Simpan";
      }
    </script>
  </body>
</html>
